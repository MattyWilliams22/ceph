@let data=(data$ | async);
@let colorClass="overview-health-card-status--" + vm?.health?.icon;
<cd-productive-card class="overview-health-card">
  <!-- HEALTH CARD Title -->
  @if(vm?.fsid) {
  <ng-template #header>
    <div class="overview-health-card-header">
      <div class="cds-mb-4 cds-mr-3">
        <cd-icon type="dataCenter"></cd-icon>
      </div>
      <h2 class="cds--type-heading-compact-02"
          id="fsid">
        <span class="cds-mr-2">{{vm?.fsid}}</span>
      </h2>
      <cd-copy-2-clipboard-button
        size="sm"
        title="Copy cluster fsid"
        i18n-title
        source="fsid">
      </cd-copy-2-clipboard-button>
    </div>
    <cds-icon-button
      type="button"
      kind="ghost"
      size="sm"
      description="Check logs"
      i18n-description
      [routerLink]="['/logs']">
      <cd-icon type="dataViewAlt"></cd-icon>
    </cds-icon-button>
  </ng-template>
  } @else {
  <cds-skeleton-text
    [lines]="1"
    [maxLineWidth]="400"
    [minLineWidth]="400"></cds-skeleton-text>
  }
  <!-- HEALTH CARD BODY -->
  @if(vm?.health){
  <p class="cds--type-heading-05 cds-mb-0"
     [ngClass]="colorClass">
    {{vm?.health?.title}}
    <cd-icon [type]="vm?.health?.icon"></cd-icon>
  </p>
  <p class="cds--type-label-01 overview-health-card-secondary-text">{{vm?.health?.message}}</p>
  } @else {
  <cds-skeleton-placeholder></cds-skeleton-placeholder>
  }

  @if(data?.summary?.version) {
  <!-- CEPH VERSION -->
  <p class="cds--type-label-02">
    <span i18n>Ceph version:&nbsp;</span>
    <span class="cds--type-heading-compact-01">{{ data?.summary?.version | cephVersion  }}</span>&nbsp;
    @if (data?.upgrade?.versions?.length) {
    <a [routerLink]="['/upgrade']"
       cdsLink
       [inline]="true"
       i18n>
      Upgrade available
      <cd-icon type="upgrade"></cd-icon>
    </a>
    }
  </p>
  } @else {
  <cds-skeleton-text
    [lines]="1"
    [maxLineWidth]="250"></cds-skeleton-text>
  }
  <!-- TABS -->
  <div cdsStack="horizontal"
       [gap]="4">
  <!-- HEALTH CHECKS -->
  @if(vm?.incidents > 0) {
  <div>
    <cd-icon
      type="incidentReporter"
      [ngClass]="colorClass"></cd-icon>
    <cds-tooltip-definition
      [highContrast]="true"
      [openOnHover]="true"
      [dropShadow]="true"
      [caret]="true"
      (click)="onViewIncidentsClick()"
      description="Click to view health incidents"
      i18n-description>
      <span
        class="cds--type-heading-compact-01"
        [ngClass]="colorClass"
        i18n>
        {{vm?.incidents}} Health incidents
      </span>
    </cds-tooltip-definition>
    <cds-tooltip
      class="cds-ml-3"
      [caret]="true"
      description="Health incidents represent Ceph health check warnings that indicate abnormal conditions requiring intervention and persist until the condition is resolved."
      i8n-description
    >
      <cd-icon type="help"></cd-icon>&nbsp;|
    </cds-tooltip>
  </div>
  }
  <!-- SYSTEM TAB -->
  @if(vm?.overallSystemSev) {
    <div [ngClass]="{'overview-health-card-tab-selected': activeSection === 'system'}">
      <cd-icon
        [type]="vm?.overallSystemSev"></cd-icon>
      <cds-tooltip-definition
        [highContrast]="true"
        [openOnHover]="true"
        [dropShadow]="true"
        class="cds-ml-2"
        [caret]="true"
        (click)="toggleSection('system')"
        description="Click to view health incidents"
        i18n-description>
        <span
          i18n>
          Systems
        </span>
      </cds-tooltip-definition>
    </div>
  } @else {
  <cds-skeleton-text [lines]="1"></cds-skeleton-text>
  }
  </div>

  <!-- TAB CONTENT -->
  <div  [ngSwitch]="activeSection">
    <ng-container *ngSwitchCase="'system'">
      <div class="overview-health-card-tab-content">
        <p class="overview-health-card-secondary-text cds--type-body-compact-01"
           i18n>Some cluster components are degraded and may require attention.</p>
        <div cdsStack="horizontal"
             [gap]="8">
          <div class="overview-health-card-tab-content-item cds-pr-8">
            <span>
              <cd-icon [type]="vm?.mon?.severity"></cd-icon>
              <span class="cds--type-body-compact-01 cds-ml-2">Monitor</span>
            </span>
            <p class="cds--type-label-01 cds-mt-3 overview-health-card-secondary-text">Quorum: {{vm?.mon?.value}}</p>
          </div>
          <div class="overview-health-card-tab-content-item cds-pr-8">
            <span>
              <cd-icon [type]="vm?.mgr?.severity"></cd-icon>
              <span class="cds--type-body-compact-01 cds-ml-2">Manager</span>
            </span>
            <p class="cds--type-label-01 cds-mt-3 overview-health-card-secondary-text">{{vm?.mgr?.value}}</p>
          </div>
          <div class="overview-health-card-tab-content-item cds-pr-8">
            <span>
              <cd-icon [type]="vm?.osd?.severity"></cd-icon>
              <span class="cds--type-body-compact-01 cds-ml-2"
                    i18n>OSD</span>
            </span>
            <p class="cds--type-label-01 cds-mt-3 overview-health-card-secondary-text">{{vm?.osd?.value}}</p>
          </div>
          <div>
            <span>
              <cd-icon [type]="vm?.hosts?.severity"></cd-icon>
              <span class="cds--type-body-compact-01 cds-ml-2">Nodes</span>
            </span>
            <p class="cds--type-label-01 cds-mt-3 overview-health-card-secondary-text">{{vm?.hosts?.value}}</p>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container *ngSwitchDefault></ng-container>
  </div>
</cd-productive-card>
